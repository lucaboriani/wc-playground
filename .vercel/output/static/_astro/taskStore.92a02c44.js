import{r as h}from"./index.ed373d49.js";import{a as y}from"./axios.4a70c6fc.js";let k=0,v=[];function I(){return k+=1,()=>{if(k-=1,k===0){let e=v;v=[];for(let t of e)t()}}}let f=Symbol(),p=Symbol(),x=0,K=(e,t,s,n)=>{let l=++x,i={...e};i.set=(...a)=>{e[f]=t,e[p]=l,e.set(...a),delete e[f],delete e[p]},e.setKey&&(i.setKey=(...a)=>{e[f]=t,e[p]=l,e.setKey(...a),delete e[f],delete e[p]});let o=s(i,...n);if(o instanceof Promise){let[a,r]=typeof e.action<"u"?e.action(l,t,n):[],u=I();return o.catch(g=>{throw a&&a(g),g}).finally(()=>{u(),r&&r()})}return o},m=(e,t,s)=>(...n)=>K(e,t,s,n);function S(e,t,s){let n=new Set([...t,void 0]);return e.listen((l,i)=>{n.has(i)&&s(l,i)})}let c=[],b=(e,t)=>{let s,n=[],l={lc:0,l:t||0,value:e,set(i){l.value=i,l.notify()},get(){return l.lc||l.listen(()=>{})(),l.value},notify(i){s=n;let o=!c.length;for(let a=0;a<s.length;a+=2)c.push(s[a],l.value,i,s[a+1]);if(o){for(let a=0;a<c.length;a+=4){let r=!1;for(let u=a+7;u<c.length;u+=4)if(c[u]<c[a+3]){r=!0;break}r?c.push(c[a],c[a+1],c[a+2],c[a+3]):c[a](c[a+1],c[a+2])}c.length=0}},listen(i,o){return n===s&&(n=n.slice()),l.lc=n.push(i,o||l.l)/2,()=>{n===s&&(n=n.slice());let a=n.indexOf(i);~a&&(n.splice(a,2),l.lc--,l.lc||l.off())}},subscribe(i,o){let a=l.listen(i,o);return i(l.value),a},off(){}};return l},w=(e={})=>{let t=b(e);return t.setKey=function(s,n){typeof n>"u"?s in t.value&&(t.value={...t.value},delete t.value[s],t.notify(s)):t.value[s]!==n&&(t.value={...t.value,[s]:n},t.notify(s))},t};function z(e,t={}){let s=h.useCallback(l=>t.keys?S(e,t.keys,l):e.listen(l),[t.keys,e]),n=e.get.bind(e);return h.useSyncExternalStore(s,n,n)}const E="http://localhost:3000/api",T=E+"/tasks",_=async e=>{try{if(e._id){const{data:t}=await y.post(T+"/"+e._id+".json",{task:e.task});return t}else{const{data:t}=await y.post(T+"/tasks.json",{task:e.task});return t}}catch(t){console.log(t)}},j="http://localhost:3000/api",$=j+"/tasks",L=async(e,t)=>{try{const{data:s}=await y.post($+"/"+e+".json",{completed:!t});return s}catch(s){console.log(s)}},A="http://localhost:3000/api",O=A+"/tasks",Q=async e=>{try{return await y.delete(O+"/"+e+".json"),e}catch(t){console.log(t)}},d=w({}),B=m(d,"initTaskItems",async(e,t)=>(Object.values(t).forEach(s=>{e.setKey(s._id,{_id:s._id,task:s.task,completed:s.completed})}),e.get())),P=b({task:""}),C=e=>{P.set(d.get()[e])},F=m(d,"postTaskItem",async(e,t)=>{const{insertedId:s}=await _(t),{task:n}=t,l=e.get()[s];return l?e.setKey(s,{...l,task:n,completed:l.completed}):e.setKey(s,{insertedId:s,task:n,completed:!1}),e.get()}),G=m(d,"updateTaskItem",async(e,t)=>{const{data:s}=await L(t._id,t.completed),{_id:n,task:l,completed:i}=s,o=e.get()[n];return o&&e.setKey(n,{...o,task:l,completed:i}),e.get()}),H=m(d,"deleteTaskItem",async(e,t)=>{await Q(t);const s={...e.get()};return s[t]&&(delete s[t],e.set(s)),e.get()});export{G as a,B as b,H as d,P as i,F as p,C as s,d as t,z as u};
